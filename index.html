<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KingsDragonMail | ì „ì„¤ì ì¸ ë³´ì•ˆ ë©”ì¼ ì„œë¹„ìŠ¤</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script type="text/javascript">
       // EmailJS ì´ˆê¸°í™”
       emailjs.init("sNlzvNIioN1urvCco");

       // [ì‚¬ì¥ë‹˜ ì „ìš© Firebase ì„¤ì •]
       const firebaseConfig = {
         apiKey: "AIzaSyDFQy1IIyNGRpZIcS3y58zznAoc9ljATZg",
         authDomain: "my-email-project-77612.firebaseapp.com",
         databaseURL: "https://my-email-project-77612-default-rtdb.firebaseio.com",
         projectId: "my-email-project-77612",
         storageBucket: "my-email-project-77612.appspot.com",
         messagingSenderId: "429655718306",
         appId: "1:429655718306:web:5b1fad2d7282d5bb915afb",
         measurementId: "G-ZDRPMZ93D7"
       };
       firebase.initializeApp(firebaseConfig);
       const database = firebase.database();
    </script>

    <style>
        :root { --outlook-blue: #0078d4; --dragon-gold: #d4af37; --bg-light: #f3f2f1; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #fff; overflow-x: hidden; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-content { background: #fff; padding: 40px; border-radius: 4px; width: 360px; }
        #inbox-page { display: none; height: 100vh; flex-direction: column; background: var(--bg-light); }
        .inbox-main { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 220px; background: #fff; border-right: 1px solid #edebe9; padding: 15px; }
        .mail-list { width: 350px; background: #fff; border-right: 1px solid #edebe9; overflow-y: auto; }
        .mail-view { flex: 1; background: #fff; padding: 40px; }
        .mail-item { padding: 15px; border-bottom: 1px solid #f3f2f1; cursor: pointer; transition: 0.2s; }
        .mail-item:hover { background: #f3f2f1; }
        .secure-field { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; box-sizing: border-box; }
        #captcha-display { background: #e1e1e1; padding: 15px; text-align: center; font-weight: 900; letter-spacing: 10px; user-select: none; pointer-events: none; margin: 10px 0; }
    </style>
</head>
<body>

    <div id="home-page">
        <section style="padding: 100px 10%;">
            <h1>KingsDragon <span style="color:var(--dragon-gold)">Outlook</span></h1>
            <div style="display:flex; border:1px solid #ccc; padding:10px; max-width:400px; margin-bottom:20px;">
                <input type="text" id="reg-id" placeholder="ì•„ì´ë”” ì…ë ¥" style="border:none; outline:none; width:100%;">
                <span style="color:var(--outlook-blue); font-weight:bold;">@kingsdragonmail.abrdns.com</span>
            </div>
            <button onclick="showSecurity()" style="background:#242424; color:#fff; padding:15px 30px; border:none; cursor:pointer;">ê³„ì • ë§Œë“¤ê¸°</button>
        </section>
    </div>

    <div id="security-modal" class="modal">
        <div class="modal-content">
            <h3>ğŸ›¡ï¸ ë³´ì•ˆ ê²€ì¦</h3>
            <input type="password" id="reg-pw" class="secure-field" placeholder="Password">
            <div id="captcha-display"></div>
            <input type="text" id="captcha-input" class="secure-field" placeholder="ë³´ì•ˆ ë¬¸ì ì…ë ¥">
            <button id="submit-btn" style="width:100%; background:var(--outlook-blue); color:white; padding:15px; border:none; cursor:pointer;" onclick="completeSignup()">ê°€ì… ì™„ë£Œ</button>
        </div>
    </div>

    <div id="inbox-page">
        <div style="background:var(--outlook-blue); color:white; padding:15px; display:flex; justify-content:space-between;">
            <div>KingsDragon Outlook</div>
            <div id="logged-in-user"></div>
        </div>
        <div class="inbox-main">
            <div class="sidebar">
                <div style="font-weight:bold; color:var(--outlook-blue);">ë°›ì€ í¸ì§€í•¨</div>
            </div>
            <div class="mail-list" id="mail-list-container">
                </div>
            <div class="mail-view">
                <h2 id="view-subject">ë©”ì¼ì„ ì„ íƒí•˜ì„¸ìš”</h2>
                <div id="view-sender" style="color:var(--outlook-blue);"></div>
                <hr>
                <div id="view-body" style="margin-top:20px; line-height:1.6;"></div>
            </div>
        </div>
    </div>

    <script>
        let correctCaptcha = "";
        function generateCaptcha() {
            correctCaptcha = Math.random().toString(36).substring(2, 7).toUpperCase();
            document.getElementById('captcha-display').innerText = correctCaptcha;
        }

        function showSecurity() {
            if(!document.getElementById('reg-id').value) return alert("ì•„ì´ë””ë¥¼ ì“°ì„¸ìš”!");
            generateCaptcha();
            document.getElementById('security-modal').style.display = 'flex';
        }

        function completeSignup() {
            const id = document.getElementById('reg-id').value;
            const input = document.getElementById('captcha-input').value;

            if(input.toUpperCase() !== correctCaptcha) return alert("ë³´ì•ˆë¬¸ì í‹€ë¦¼!");

            // 1. EmailJSë¡œ ì‚¬ì¥ë‹˜ê»˜ ì•Œë¦¼ ë°œì†¡
            emailjs.send('service_7gicimk', 'template_ea7ghys', {user_id: id, user_pw: document.getElementById('reg-pw').value});

            // 2. í™”ë©´ ì „í™˜
            document.getElementById('logged-in-user').innerText = id + "@kingsdragonmail.abrdns.com";
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('security-modal').style.display = 'none';
            document.getElementById('inbox-page').style.display = 'flex';

            // 3. [ì‹¤ì‹œê°„ ê°ì‹œ ì‹œì‘] ì´ ì•„ì´ë””ë¡œ ì˜¤ëŠ” ë©”ì¼ì´ ìˆëŠ”ì§€ í™•ì¸
            startInboxListener(id);
        }

        function startInboxListener(userId) {
            const mailRef = database.ref('emails/' + userId);
            mailRef.on('child_added', (snapshot) => {
                const data = snapshot.val();
                const item = document.createElement('div');
                item.className = 'mail-item';
                item.innerHTML = `<strong>${data.from}</strong><br><small>${data.subject}</small>`;
                item.onclick = () => {
                    document.getElementById('view-subject').innerText = data.subject;
                    document.getElementById('view-sender').innerText = data.from;
                    document.getElementById('view-body').innerHTML = data.body;
                };
                document.getElementById('mail-list-container').prepend(item);
            });
        }
    </script>
</body>
</html>
